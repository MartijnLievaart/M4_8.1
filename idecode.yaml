#
#
#

bitsize: 24
phases:  8
control_lines_offset: 2048
alias:
  abus(pc): op0(abuspc)
  abus(sp): op0(abussp)
  abus(hl): op0(abushl)
  abus(t):  op0(abust)
  halt:     op0(halt)

register_lines:
  op0:
    offset: 1
    regs:
      - ''
      - abuspc
      - abussp
      - abushl
      - abust
      - halt
      - cnst1
      - cnstff
  aluop:
    offset: 1
    regs:
      - ADD
      - SUB
      - AND
      - OR
      - XOR
      - INV
      - SHL
      - SHR
  cond:
    offset: 1
    regs:
      - Z
      - NZ
      - C
      - NC
  load:
    offset: 8
    regs:
      - ''
      - mem
      - pc
      - sph
      - spl
      - th
      - tl
      - a
      - b
      - h
      - l
      - c
      - z

  dbus:
    offset: 128
    regs:
      - ''
      - mem
      - pch
      - pcl
      - sph
      - spl
      - tl
      - a
      - b
      - h
      - l
      - s
      - alu
      - cnst


control_lines:
  - nxtic
  - nxti
  - pcinc
  - op0
  - spop
  - spup
  - aluen

# ph0 hardwired to pcinc, abus(pc), dbus(mem), load(IR)
instructions:
  - mne: LDA
    op: 0x00
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(a)
  - mne: LDB
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(b)
  - mne: LDH
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(h)
  - mne: LDL
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(l)

  - mne: LDAI
    op: 0x04
    ph:
    - abus(hl), dbus(mem), load(a)
  - mne: LDBI
    ph:
    - abus(hl), dbus(mem), load(b)

  - mne: LDAD
    op: 0x08
    ph:
    - abus(pc), dbus(mem), load(a), pcinc
  - mne: LDBD
    ph:
    - abus(pc), dbus(mem), load(b), pcinc
  - mne: LDHD
    ph:
    - abus(pc), dbus(mem), load(h), pcinc
  - mne: LDLD
    ph:
    - abus(pc), dbus(mem), load(l), pcinc

  - mne: STA
    op: 0x10
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(a), load(mem)
  - mne: STB
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(b), load(mem)
  - mne: STH
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(h), load(mem)
  - mne: STL
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(l), load(mem)

  - mne: STAI
    op: 0x14
    ph:
    - abus(hl), dbus(a), load(mem)
  - mne: STBI
    ph:
    - abus(hl), dbus(b), load(mem)

  - mne: LDSPD
    op: 0x20
    ph:
    - load(sph), pcinc, abus(pc), dbus(mem)
    - load(spl), pcinc, abus(pc), dbus(mem)
  - mne: LDHLD
    ph:
    - load(h), pcinc, abus(pc), dbus(mem)
    - load(l), pcinc, abus(pc), dbus(mem)

  - mne: MVAB
    op: 0x50
    ph:
    - dbus(a), load(b)
  - mne: MVAL
    ph:
    - dbus(a), load(l)
  - mne: MVAH
    ph:
    - dbus(a), load(h)
  - mne: MVBA
    ph:
    - dbus(b), load(a)
  - mne: MVBL
    ph:
    - dbus(b), load(l)
  - mne: MVBH
    ph:
    - dbus(b), load(h)
  - mne: MVLA
    ph:
    - dbus(l), load(a)
  - mne: MVLB
    ph:
    - dbus(l), load(b)
  - mne: MVLH
    ph:
    - dbus(l), load(h)
  - mne: MVHA
    ph:
    - dbus(h), load(a)
  - mne: MVHB
    ph:
    - dbus(h), load(b)
  - mne: MVHL
    ph:
    - dbus(h), load(l)

  - mne: XAB
    ph:
    - dbus(b), load(tl)
    - dbus(a), load(b)
    - dbus(tl), load(a)

  - mne: PSHA
    ph:
    - load(mem), abus(sp), dbus(a), spop
  - mne: PSHB
    ph:
    - load(mem), abus(sp), dbus(b), spop
  - mne: PSHH
    ph:
    - load(mem), abus(sp), dbus(h), spop
  - mne: PSHL
    ph:
    - load(mem), abus(sp), dbus(l), spop

  - mne: POPA
    ph:
    - spop, spup
    - load(a), abus(sp), dbus(mem)
  - mne: POPB
    ph:
    - spop, spup
    - load(b), abus(sp), dbus(mem)
  - mne: POPH
    ph:
    - spop, spup
    - load(h), abus(sp), dbus(mem)
  - mne: POPL
    ph:
    - spop, spup
    - load(l), abus(sp), dbus(mem)

  - mne: CCLR
    ph:
    - dbus(cnst), load(c)
  - mne: CSET
    ph:
    - dbus(cnst), op0(cnst1), load(c)
  - mne: ZCLR
    ph:
    - dbus(cnst), load(z)
  - mne: ZSET
    ph:
    - dbus(cnst), op0(cnst1), load(z)

  - mne: TSTZA0
    ph:
    - dbus(cnst), load(tl)
    - aluen, aluop(SUB)
  - mne: TSTZAB
    ph:
    - dbus(b), load(tl)
    - aluen, aluop(SUB)
  - mne: TSTZAD
    ph:
    - load(tl), pcinc, abus(pc), dbus(mem)
    - aluen, aluop(SUB)

  - mne: ADDB
    ph:
    - dbus(b), load(tl)
    - aluen, aluop(ADD), dbus(alu), load(a)
  - mne: ADDD
    ph:
    - load(tl), pcinc, abus(pc), dbus(mem)
    - aluen, aluop(ADD), dbus(alu), load(a)

  - mne: SUBB
    ph:
    - dbus(b), load(tl)
    - aluen, aluop(SUB), dbus(alu), load(a)
  - mne: SUBD
    ph:
    - load(tl), pcinc, abus(pc), dbus(mem)
    - aluen, aluop(SUB), dbus(alu), load(a)

  - mne: ANDB
    ph:
    - dbus(b), load(tl)
    - aluen, aluop(AND), dbus(alu), load(a)
  - mne: ANDD
    ph:
    - load(tl), pcinc, abus(pc), dbus(mem)
    - aluen, aluop(AND), dbus(alu), load(a)

  - mne: ORB
    ph:
    - dbus(b), load(tl)
    - aluen, aluop(OR), dbus(alu), load(a)
  - mne: ORD
    ph:
    - load(tl), pcinc, abus(pc), dbus(mem)
    - aluen, aluop(OR), dbus(alu), load(a)

  - mne: XORB
    ph:
    - dbus(b), load(tl)
    - aluen, aluop(XOR), dbus(alu), load(a)
  - mne: XORD
    ph:
    - load(tl), pcinc, abus(pc), dbus(mem)
    - aluen, aluop(XOR), dbus(alu), load(a)

  - mne: INV
    ph:
    - aluen, aluop(INV), dbus(alu), load(a)
  - mne: SHL
    ph:
    - aluen, aluop(SHL), dbus(alu), load(a)
  - mne: SHR
    ph:
    - aluen, aluop(SHR), dbus(alu), load(a)

  - mne: JMP
    op: 0x80
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(pc), abus(pc), dbus(mem)
  - mne: JSR
    op: 0x81
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - load(mem), abus(sp), dbus(pch), spop
    - load(mem), abus(sp), dbus(pcl), spop
    - load(pc), dbus(tl)
  - mne: RET
    op: 0x82
    ph:
    - spop, spup
    - load(tl), abus(sp), dbus(mem), spop, spup
    - load(th), abus(sp), dbus(mem)
    - load(pc), dbus(tl)
  - mne: JZ
    op: 0x83
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - cond(NZ), nxtic
    - load(pc), dbus(tl)
  - mne: JNZ
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - cond(Z), nxtic
    - load(pc), dbus(tl)
  - mne: JC
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - cond(NC), nxtic
    - load(pc), dbus(tl)
  - mne: JNC
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - cond(C), nxtic
    - load(pc), dbus(tl)

  - mne: NOP
    op: 0xfe
    ph:
    - nxti
  - mne: HLT
    op: 0xff
    ph:
    - halt

