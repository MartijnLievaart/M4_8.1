#
#
#

bitsize: 24
phases:  8
control_lines_offset: 2048

register_lines:
  abus:
    offset: 1
    regs:
      - pc
      - sp
      - hl
      - t
      - halt
  load:
    offset: 8
    regs:
      - mem
      - pc
      - sph
      - spl
      - th
      - tl
      - a
      - b
      - h
      - l
  dbus:
    offset: 128
    regs:
      - mem
      - pch
      - pcl
      - sph
      - spl
      - tl
      - a
      - b
      - h
      - l
      - s
      - alu


control_lines:
  - nxti
  - pcinc
  - abus
  - spop
  - spup

# ph0 hardwired to pcinc, abus(pc), dbus(mem), load(IR)
instructions:
  - mne: LDA
    op: 0x00
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(a)
  - mne: LDB
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(b)
  - mne: LDH
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(h)
  - mne: LDL
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(mem), load(l)

  - mne: LDAI
    op: 0x04
    ph:
    - abus(hl), dbus(mem), load(a)
  - mne: LDBI
    ph:
    - abus(hl), dbus(mem), load(b)

  - mne: LDAD
    op: 0x08
    ph:
    - abus(pc), dbus(mem), load(a), pcinc
  - mne: LDBD
    ph:
    - abus(pc), dbus(mem), load(b), pcinc
  - mne: LDHD
    ph:
    - abus(pc), dbus(mem), load(h), pcinc
  - mne: LDLD
    ph:
    - abus(pc), dbus(mem), load(l), pcinc

  - mne: STA
    op: 0x10
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(a), load(mem)
  - mne: STB
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(b), load(mem)
  - mne: STH
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(h), load(mem)
  - mne: STL
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - abus(t), dbus(l), load(mem)

  - mne: STAI
    op: 0x14
    ph:
    - abus(hl), dbus(a), load(mem)
  - mne: STBI
    ph:
    - abus(hl), dbus(b), load(mem)

  - mne: LDSPD
    op: 0x20
    ph:
    - load(sph), pcinc, abus(pc), dbus(mem)
    - load(spl), pcinc, abus(pc), dbus(mem)

  - mne: MVAB
    op: 0x50
    ph:
    - dbus(a), load(b)

  - mne: MVBA
    ph:
    - dbus(b), load(a)

  - mne: XAB
    ph:
    - dbus(b), load(tl)
    - dbus(a), load(b)
    - dbus(tl), load(a)

  - mne: JMP
    op: 0x80
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(pc), abus(pc), dbus(mem)
  - mne: JSR
    op: 0x81
    ph:
    - load(th), pcinc, abus(pc), dbus(mem)
    - load(tl), pcinc, abus(pc), dbus(mem)
    - load(mem), abus(sp), dbus(pch), spop
    - load(mem), abus(sp), dbus(pcl), spop
    - load(pc), dbus(tl)
  - mne: RET
    op: 0x82
    ph:
    - spop, spup
    - load(tl), abus(sp), dbus(mem), spop, spup
    - load(th), abus(sp), dbus(mem)
    - load(pc), dbus(tl)

  - mne: NOP
    op: 0xfe
    ph:
    - nxti
  - mne: HLT
    op: 0xff
    ph:
    # halt tagged on abus as special
    - abus(halt)

